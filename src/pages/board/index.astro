---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Hr from "@/components/Hr.astro";
import LinkButton from "@/components/LinkButton.astro";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";


// 1. 匹配实际的文件夹结构
// 假设你的 Markdown 放在 src/posts/board/*.md
const daily = import.meta.glob<{
  frontmatter: { date: string; slug: string; title: string };
  default: any;
}>('src/data/blog/news/daily/*.md', { eager: true });
// 2. 把 modules 转成数组，每项包含 frontmatter、Component（默认导出）和 filePath
const days = Object.entries(daily).map(([filePath, daily]) => ({
  filePath,
  frontmatter: daily.frontmatter,
  Component: daily.default,  // 注意这里是 default 而不是 Content
}));
// 3. 按 frontmatter.date 降序排序（最新的排在最前面）
days.sort((a, b) =>
  new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime()
);
// 4. 如果没有任何 Markdown，就显示提示
if (days.length === 0) {
  console.warn('目录中没有找到任何 Markdown 文件');
}
const day = days[0];

// 1. 匹配实际的文件夹结构
// 假设你的 Markdown 放在 src/posts/board/*.md
const modules = import.meta.glob<{
  frontmatter: { date: string; slug: string; title: string };
  default: any;
}>('src/data/blog/news/weekly/*.md', { eager: true });
// 2. 把 modules 转成数组，每项包含 frontmatter、Component（默认导出）和 filePath
const weeks = Object.entries(modules).map(([filePath, module]) => {
  const m = module as { frontmatter: { date: string; slug: string; title: string }; default: any };
  return {
    filePath,
    frontmatter: m.frontmatter,
    Component: m.default,
  };
});
// 3. 按 frontmatter.date 降序排序（最新的排在最前面）
weeks.sort((a, b) =>
  new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime()
);
// 4. 如果没有任何 Markdown，就显示提示
if (weeks.length === 0) {
  console.warn('目录中没有找到任何 Markdown 文件');
}
const week = weeks[0];

---

<Layout>
  <Header />
  <main id="main-content" data-layout="index">

    <section id="hero" class="pt-8 pb-6">
      <section/>
      

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 h-auto sm:h-full overflow-x-hidden">
  <!-- 左边：上下两栏 -->
  <div class="flex flex-col h-auto w-full">
    <!-- 日报 -->
    <section class="p-4 border rounded-lg overflow-hidden relative h-[400px] w-full">
      {day ? (
        <>
          <h2 class="text-xl font-semibold mb-2">{day.frontmatter.title}</h2>
          <p class="text-sm text-gray-500 mb-4">{day.frontmatter.date}</p>
          <day.Component />
        </>
      ) : (
        <p>暂无报告</p>
      )}
    </section>
    <div class="my-8 text-center">
      <LinkButton href="/posts/news/daily/${day.frontmatter.slug}">
        查看完整日报
        <IconArrowRight class="inline-block" />
      </LinkButton>
    </div>

    <!-- 周报 -->
    <section class="p-4 border rounded-lg overflow-hidden relative h-[400px] mt-4 w-full">
      {week ? (
        <>
          <h2 class="text-xl font-semibold mb-2">{week.frontmatter.title}</h2>
          <p class="text-sm text-gray-500 mb-4">{week.frontmatter.date}</p>
          <week.Component />
        </>
      ) : (
        <p>暂无报告</p>
      )}
    </section>
    <div class="my-8 text-center">
      <LinkButton href="/posts/news/weekly/${week.frontmatter.slug}">
        查看完整周报
        <IconArrowRight class="inline-block" />
      </LinkButton>
    </div>
  </div>

  <!-- 右边：iframe 区域 -->
  <div class="iframe-container h-[150vh] sm:h-full w-full overflow-hidden">
    <iframe
      src="https://zeli.app/zh"
      title="Zeli"
      loading="lazy"
      sandbox="allow-scripts allow-same-origin"
      class="transform origin-top-left scale-[1.3] w-[76.923%] h-[76.923%] border-[1px] border-gray-300 rounded-lg"
      
    ></iframe>
  </div>
</div>


    <Hr />
  </main>
  <Footer />
</Layout>



<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>

---
import axios from 'axios';
import { load } from 'cheerio';

/**
 * Scrape NewsNow hottest list once at build‑time.
 * Keeps the site fully static; shows fallback text on failure.
 */
const newsList = [];

try {
  // Fetch with 10‑second timeout
  const { data: html } = await axios.get(
    'https://newsnow.busiyi.world/c/hottest',
    { timeout: 10_000 }
  );

  const $ = load(html);

  // Pick every card title and its parent link
  $('.card .title').each((_, el) => {
    const title = $(el).text().trim();
    const href  = $(el).closest('a').attr('href'); // safer than parent()
    if (title && href) {
      newsList.push({
        title,
        link: `https://newsnow.busiyi.world${href}`,
      });
    }
  });
} catch (err) {
  console.error('[NewsNow] Scrape failed:', err?.message ?? err);
}
---

<section class="my-8">
  <h2 class="text-xl font-semibold mb-4">🔥 热门新闻</h2>

  {newsList.length ? (
    <ul class="space-y-2">
      {newsList.map(item => (
        <li>
          <a
            href={item.link}
            target="_blank"
            rel="noopener"
            class="text-blue-600 hover:underline"
          >
            {item.title}
          </a>
        </li>
      ))}
    </ul>
  ) : (
    <p class="text-sm text-zinc-500">暂无数据或抓取失败。</p>
  )}
</section>